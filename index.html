<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>67 Clicker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #050509;
      --panel: #101018;
      --accent: #ffdd33;
      --accent-soft: #ffd63333;
      --accent-strong: #ffcc00;
      --text: #f5f5f5;
      --muted: #aaaaaa;
      --danger: #ff5555;
      --good: #55ff99;
      --border: #202030;
      --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(circle at top, #181830 0%, #050509 60%);
      color: var(--text);
      font-family: var(--font-main);
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
    }

    .game-wrapper {
      width: 100%;
      max-width: 1100px;
      display: flex;
      flex-direction: row;
      gap: 12px;
      padding: 10px;
    }

    @media (max-width: 800px) {
      .game-wrapper {
        flex-direction: column;
        height: auto;
      }
    }

    .panel {
      background: linear-gradient(145deg, #090910, #121220);
      border-radius: 10px;
      border: 1px solid var(--border);
      padding: 10px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.6);
    }

    .left-panel {
      flex: 1.1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .right-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .header {
      text-align: center;
      margin-bottom: 4px;
    }

    .title {
      margin: 0;
      font-size: 1.6rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .subtitle {
      margin: 0;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .stats-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      font-size: 0.9rem;
    }

    .stat-pill {
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(15, 15, 25, 0.9);
      border: 1px solid var(--border);
    }

    .stat-label {
      color: var(--muted);
      margin-right: 4px;
      font-size: 0.8rem;
    }

    .stat-value {
      color: var(--accent);
      font-weight: 600;
    }

    .big-number {
      font-size: 2.1rem;
      text-align: center;
      margin: 4px 0 8px;
      font-variant-numeric: tabular-nums;
    }

    .big-number span {
      color: var(--accent-strong);
      text-shadow: 0 0 12px rgba(255, 221, 51, 0.7);
    }

    .click-area {
      display: flex;
      justify-content: center;
      margin-bottom: 8px;
    }

    .click-button {
      position: relative;
      width: min(260px, 70vw);
      height: min(260px, 70vw);
      border-radius: 50%;
      border: 3px solid var(--accent);
      background: radial-gradient(circle at 30% 20%, #ffffff22 0%, #ffdd33 15%, #ff8800 55%, #3a1300 100%);
      box-shadow:
        0 0 30px rgba(255, 221, 51, 0.7),
        0 0 80px rgba(255, 136, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #1a0b00;
      font-weight: 800;
      font-size: 3rem;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.5);
      cursor: pointer;
      user-select: none;
      transition: transform 0.07s ease, box-shadow 0.07s ease;
      overflow: hidden;
    }

    .click-button::after {
      content: "CLICK 67";
      position: absolute;
      bottom: 10px;
      font-size: 0.9rem;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      opacity: 0.8;
    }

    .click-button:active {
      transform: scale(0.94);
      box-shadow:
        0 0 16px rgba(255, 221, 51, 0.8),
        0 0 40px rgba(255, 136, 0, 0.5);
    }

    .click-amount {
      position: absolute;
      top: 14px;
      font-size: 0.8rem;
      background: rgba(0, 0, 0, 0.45);
      padding: 3px 6px;
      border-radius: 999px;
      color: var(--accent);
      border: 1px solid rgba(255, 221, 51, 0.4);
    }

    .log-panel {
      font-size: 0.8rem;
      height: 80px;
      overflow-y: auto;
      background: rgba(0, 0, 0, 0.25);
      border-radius: 6px;
      padding: 6px;
      border: 1px solid var(--border);
    }

    .log-line {
      color: var(--muted);
      margin-bottom: 2px;
    }

    .log-line strong {
      color: var(--accent);
    }

    .section-title {
      font-size: 1rem;
      margin-top: 0;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--muted);
    }

    .upgrades-list,
    .achievements-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 260px;
      overflow-y: auto;
    }

    @media (max-width: 800px) {
      .upgrades-list,
      .achievements-list {
        max-height: 180px;
      }
    }

    .card {
      border-radius: 6px;
      padding: 7px 8px;
      background: rgba(0, 0, 0, 0.35);
      border: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .card-main {
      flex: 1;
      min-width: 0;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 1px;
    }

    .card-desc {
      font-size: 0.78rem;
      color: var(--muted);
    }

    .card-meta {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 3px;
    }

    .card-badge {
      font-size: 0.72rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(255, 221, 51, 0.09);
      color: var(--accent);
    }

    .btn {
      border-radius: 999px;
      border: none;
      padding: 6px 10px;
      font-size: 0.8rem;
      font-weight: 600;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      white-space: nowrap;
      user-select: none;
      transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.1s ease;
    }

    .btn:active {
      transform: scale(0.95);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #ffdd33, #ff8800);
      color: #1a0b00;
      box-shadow: 0 0 10px rgba(255, 221, 51, 0.6);
    }

    .btn-primary.disabled {
      background: #444444;
      color: #cccccc;
      box-shadow: none;
      cursor: not-allowed;
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid var(--border);
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.03);
    }

    .achievements-list .card {
      opacity: 0.4;
    }

    .achievements-list .card.unlocked {
      opacity: 1;
      border-color: var(--accent-soft);
      background: radial-gradient(circle at top left, rgba(255, 221, 51, 0.2), rgba(0, 0, 0, 0.5));
    }

    .achievements-list .card.unlocked .card-badge {
      background: rgba(85, 255, 153, 0.1);
      border-color: rgba(85, 255, 153, 0.6);
      color: var(--good);
    }

    .prestige-panel {
      margin-top: 4px;
    }

    .prestige-info {
      font-size: 0.78rem;
      color: var(--muted);
      margin-bottom: 4px;
    }

    .prestige-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: space-between;
    }

    .prestige-pill {
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 0.78rem;
      border: 1px solid var(--border);
      background: rgba(0, 0, 0, 0.35);
    }

    .footer-buttons {
      margin-top: 6px;
      display: flex;
      justify-content: space-between;
      gap: 6px;
      flex-wrap: wrap;
    }

    .tap-hint {
      text-align: center;
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 2px;
    }

    .pop {
      position: fixed;
      pointer-events: none;
      color: var(--accent);
      font-size: 0.9rem;
      text-shadow: 0 0 4px rgba(0, 0, 0, 0.8);
      z-index: 9999;
      animation: pop-up 0.6s ease-out forwards;
    }

    @keyframes pop-up {
      from {
        opacity: 1;
        transform: translateY(0);
      }
      to {
        opacity: 0;
        transform: translateY(-25px);
      }
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <!-- LEFT: Main clicker + stats -->
    <div class="left-panel panel">
      <div class="header">
        <h1 class="title">67 CLICKER</h1>
        <p class="subtitle">The meme never ends. Only multiplies.</p>
      </div>

      <div class="stats-bar">
        <div class="stat-pill">
          <span class="stat-label">Current 67s:</span>
          <span id="stat-current" class="stat-value">0</span>
        </div>
        <div class="stat-pill">
          <span class="stat-label">Per click:</span>
          <span id="stat-per-click" class="stat-value">1</span>
        </div>
        <div class="stat-pill">
          <span class="stat-label">Per second:</span>
          <span id="stat-per-second" class="stat-value">0</span>
        </div>
        <div class="stat-pill">
          <span class="stat-label">Total 67s:</span>
          <span id="stat-total" class="stat-value">0</span>
        </div>
        <div class="stat-pill">
          <span class="stat-label">Prestige level:</span>
          <span id="stat-prestige" class="stat-value">0</span>
        </div>
      </div>

      <div class="big-number">
        You own <span id="big-number">0</span> <strong>67</strong>s
      </div>

      <div class="click-area">
        <div id="main-click" class="click-button">
          <div class="click-amount" id="click-amount-display">+1 per tap</div>
          67
        </div>
      </div>

      <div class="tap-hint">Tap / click the 67 ball to farm the meme.</div>

      <div class="log-panel" id="log-panel"></div>

      <div class="footer-buttons">
        <button id="btn-save" class="btn btn-ghost">Save</button>
        <button id="btn-hard-reset" class="btn btn-ghost">Hard Reset</button>
        <span style="font-size:0.7rem;color:var(--muted);flex:1;text-align:right;">
          Data auto-saves every few seconds to this device.
        </span>
      </div>
    </div>

    <!-- RIGHT: Upgrades / Achievements / Prestige -->
    <div class="right-panel">
      <div class="panel">
        <h2 class="section-title">Upgrades</h2>
        <div id="upgrades" class="upgrades-list"></div>
      </div>

      <div class="panel">
        <h2 class="section-title">Achievements</h2>
        <div id="achievements" class="achievements-list"></div>
      </div>

      <div class="panel prestige-panel">
        <h2 class="section-title">Prestige</h2>
        <div class="prestige-info">
          Reset everything for permanent <strong>67 Aura</strong> that multiplies all 67 gain forever.
        </div>
        <div class="prestige-row">
          <div class="prestige-pill">
            <span style="color:var(--muted);font-size:0.75rem;">67 Aura:</span>
            <span id="prestige-points" style="color:var(--accent);font-weight:600;">0</span>
          </div>
          <div class="prestige-pill">
            <span style="color:var(--muted);font-size:0.75rem;">Multiplier:</span>
            <span id="prestige-mult" style="color:var(--good);font-weight:600;">x1.00</span>
          </div>
          <button id="btn-prestige" class="btn btn-primary disabled" style="margin-left:auto;">
            Ascend 67
          </button>
        </div>
        <div class="prestige-info" id="prestige-requirement">
          Need at least 10,000 total 67s to prestige.
        </div>
      </div>
    </div>
  </div>

  <script>
    /**********************
     * GAME STATE & CONFIG
     **********************/
    const SAVE_KEY = "sixtySevenClickerSave_v1";

    const gameState = {
      currency: 0,
      totalCurrency: 0,
      totalClicks: 0,
      perClickBase: 1,
      perSecondBase: 0,
      upgrades: {},
      achievementsUnlocked: {},
      prestigeLevel: 0,
      prestigePoints: 0,
      lastTick: Date.now()
    };

    const upgradesConfig = [
      {
        id: "click_plus_1",
        name: "Finger of 67",
        desc: "+1 per click. The meme intensifies.",
        baseCost: 50,
        costScale: 1.35,
        type: "click",
        value: 1
      },
      {
        id: "click_plus_5",
        name: "Double-Handed 67",
        desc: "+5 per click.",
        baseCost: 350,
        costScale: 1.4,
        type: "click",
        value: 5
      },
      {
        id: "click_plus_25",
        name: "Mechanical 67 Tapper",
        desc: "+25 per click.",
        baseCost: 2500,
        costScale: 1.45,
        type: "click",
        value: 25
      },
      {
        id: "auto_1",
        name: "Background 67 Loop",
        desc: "Generates 1 67 per second.",
        baseCost: 100,
        costScale: 1.3,
        type: "auto",
        value: 1
      },
      {
        id: "auto_5",
        name: "Infinite 67 GIF Farm",
        desc: "Generates 5 67s per second.",
        baseCost: 900,
        costScale: 1.32,
        type: "auto",
        value: 5
      },
      {
        id: "auto_25",
        name: "67 Dedicated Server",
        desc: "Generates 25 67s per second.",
        baseCost: 8000,
        costScale: 1.35,
        type: "auto",
        value: 25
      }
    ];

    const achievementsConfig = [
      {
        id: "first_click",
        name: "First 67",
        desc: "Click the 67 once.",
        check: (s) => s.totalClicks >= 1,
        rewardText: "+5% all 67 gain (flavor only)."
      },
      {
        id: "hundred_clicks",
        name: "67 Spam",
        desc: "Click 67 one hundred times.",
        check: (s) => s.totalClicks >= 100,
        rewardText: "Proof you really want 67."
      },
      {
        id: "thousand_total",
        name: "67 Collector",
        desc: "Reach 1,000 total 67s.",
        check: (s) => s.totalCurrency >= 1000,
        rewardText: "The meme sees you."
      },
      {
        id: "tenk_total",
        name: "67 Hoarder",
        desc: "Reach 10,000 total 67s.",
        check: (s) => s.totalCurrency >= 10000,
        rewardText: "You’re ready to ascend."
      },
      {
        id: "first_prestige",
        name: "Ascended 67",
        desc: "Prestige at least once.",
        check: (s) => s.prestigeLevel >= 1,
        rewardText: "67 Aura unlocked."
      },
      {
        id: "deep_prestige",
        name: "67 Overlord",
        desc: "Prestige 5 times.",
        check: (s) => s.prestigeLevel >= 5,
        rewardText: "The number obeys you."
      }
    ];

    const prestigeConfig = {
      baseRequirement: 10000,
      scaling: 3,
      pointsPerLog10: 1.5
    };

    /**********************
     * UTILITIES
     **********************/
    function formatNumber(n) {
      if (n < 1000) return n.toFixed(0);
      if (n < 1e6) return (n / 1e3).toFixed(1).replace(/\.0$/, "") + "K";
      if (n < 1e9) return (n / 1e6).toFixed(2).replace(/\.0+$/, "") + "M";
      if (n < 1e12) return (n / 1e9).toFixed(2).replace(/\.0+$/, "") + "B";
      return n.toExponential(2);
    }

    function addLog(msg) {
      const panel = document.getElementById("log-panel");
      const line = document.createElement("div");
      line.className = "log-line";
      line.innerHTML = msg;
      panel.appendChild(line);
      while (panel.children.length > 40) {
        panel.removeChild(panel.firstChild);
      }
      panel.scrollTop = panel.scrollHeight;
    }

    function spawnPop(x, y, text) {
      const el = document.createElement("div");
      el.className = "pop";
      el.textContent = text;
      el.style.left = x + "px";
      el.style.top = y + "px";
      document.body.appendChild(el);
      setTimeout(() => {
        if (el.parentNode) el.parentNode.removeChild(el);
      }, 600);
    }

    function getTotalClickPower() {
      let base = gameState.perClickBase;
      let bonus = 0;
      for (const id in gameState.upgrades) {
        const u = upgradesConfig.find((x) => x.id === id);
        if (!u || u.type !== "click") continue;
        bonus += u.value * gameState.upgrades[id];
      }
      const auraMult = getPrestigeMultiplier();
      return (base + bonus) * auraMult;
    }

    function getTotalAutoPower() {
      let base = gameState.perSecondBase;
      let bonus = 0;
      for (const id in gameState.upgrades) {
        const u = upgradesConfig.find((x) => x.id === id);
        if (!u || u.type !== "auto") continue;
        bonus += u.value * gameState.upgrades[id];
      }
      const auraMult = getPrestigeMultiplier();
      return (base + bonus) * auraMult;
    }

    function getPrestigeMultiplier() {
      return 1 + gameState.prestigePoints * 0.15;
    }

    function getPrestigeRequirement() {
      // requirement scales with prestige level
      return prestigeConfig.baseRequirement * Math.pow(prestigeConfig.scaling, gameState.prestigeLevel);
    }

    function calculatePrestigeGain() {
      const req = getPrestigeRequirement();
      if (gameState.totalCurrency < req) return 0;
      // Use logarithm-based scaling for points
      const ratio = gameState.totalCurrency / req;
      const gain = Math.floor(Math.log10(ratio + 1) * prestigeConfig.pointsPerLog10);
      return gain > 0 ? gain : 0;
    }

    /**********************
     * SAVE / LOAD
     **********************/
    function saveGame() {
      try {
        const saveObj = JSON.parse(JSON.stringify(gameState));
        localStorage.setItem(SAVE_KEY, JSON.stringify(saveObj));
        addLog("<strong>Saved:</strong> 67 data stored on this device.");
      } catch (e) {
        console.error("Save failed", e);
        addLog("<strong>Save failed:</strong> Unable to write to storage.");
      }
    }

    function loadGame() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (!raw) return;
        const data = JSON.parse(raw);
        Object.assign(gameState, data);
        gameState.lastTick = Date.now();
        addLog("<strong>Loaded:</strong> 67 data restored from this device.");
      } catch (e) {
        console.error("Load failed", e);
        addLog("<strong>Load failed:</strong> Corrupted or unreadable save.");
      }
    }

    function hardReset() {
      if (!confirm("Hard reset will erase all progress on this device. Are you sure?")) return;
      localStorage.removeItem(SAVE_KEY);
      location.reload();
    }

    /**********************
     * UI RENDERING
     **********************/
    function renderUpgrades() {
      const container = document.getElementById("upgrades");
      container.innerHTML = "";

      upgradesConfig.forEach((u) => {
        const count = gameState.upgrades[u.id] || 0;
        const cost = getUpgradeCost(u, count);

        const card = document.createElement("div");
        card.className = "card";

        const main = document.createElement("div");
        main.className = "card-main";

        const title = document.createElement("div");
        title.className = "card-title";
        title.textContent = u.name;

        const desc = document.createElement("div");
        desc.className = "card-desc";
        desc.textContent = u.desc;

        const meta = document.createElement("div");
        meta.className = "card-meta";
        meta.innerHTML =
          "Cost: <span style='color:var(--accent);font-weight:600;'>" +
          formatNumber(cost) +
          "</span> 67 • Owned: <span style='color:var(--good);font-weight:600;'>" +
          count +
          "</span>";

        main.appendChild(title);
        main.appendChild(desc);
        main.appendChild(meta);

        const side = document.createElement("div");
        side.style.display = "flex";
        side.style.flexDirection = "column";
        side.style.alignItems = "flex-end";
        side.style.gap = "4px";

        const badge = document.createElement("div");
        badge.className = "card-badge";
        badge.textContent = u.type === "click" ? "+ " + u.value + " / click" : "+ " + u.value + " / sec";

        const btn = document.createElement("button");
        btn.className = "btn btn-primary";
        btn.textContent = "Buy";
        if (gameState.currency < cost) {
          btn.classList.add("disabled");
        }
        btn.addEventListener("click", () => {
          buyUpgrade(u.id);
        });

        side.appendChild(badge);
        side.appendChild(btn);

        card.appendChild(main);
        card.appendChild(side);
        container.appendChild(card);
      });
    }

    function renderAchievements() {
      const container = document.getElementById("achievements");
      container.innerHTML = "";

      achievementsConfig.forEach((a) => {
        const unlocked = !!gameState.achievementsUnlocked[a.id];
        const card = document.createElement("div");
        card.className = "card" + (unlocked ? " unlocked" : "");

        const main = document.createElement("div");
        main.className = "card-main";

        const title = document.createElement("div");
        title.className = "card-title";
        title.textContent = unlocked ? a.name : "???";

        const desc = document.createElement("div");
        desc.className = "card-desc";
        desc.textContent = unlocked ? a.desc : "Unlock this 67 achievement to reveal it.";

        const meta = document.createElement("div");
        meta.className = "card-meta";
        meta.innerHTML = unlocked ? a.rewardText : "Progress: Hidden";

        main.appendChild(title);
        main.appendChild(desc);
        main.appendChild(meta);

        const side = document.createElement("div");
        side.style.display = "flex";
        side.style.alignItems = "center";

        const badge = document.createElement("div");
        badge.className = "card-badge";
        badge.textContent = unlocked ? "Unlocked" : "Locked";

        side.appendChild(badge);
        card.appendChild(main);
        card.appendChild(side);
        container.appendChild(card);
      });
    }

    function renderStats() {
      const curr = document.getElementById("stat-current");
      const total = document.getElementById("stat-total");
      const perClick = document.getElementById("stat-per-click");
      const perSecond = document.getElementById("stat-per-second");
      const prestige = document.getElementById("stat-prestige");
      const big = document.getElementById("big-number");
      const clickDisplay = document.getElementById("click-amount-display");

      curr.textContent = formatNumber(gameState.currency);
      total.textContent = formatNumber(gameState.totalCurrency);
      perClick.textContent = formatNumber(getTotalClickPower());
      perSecond.textContent = formatNumber(getTotalAutoPower());
      prestige.textContent = gameState.prestigeLevel;
      big.textContent = formatNumber(gameState.currency);
      clickDisplay.textContent = "+" + formatNumber(getTotalClickPower()) + " per tap";

      const pPoints = document.getElementById("prestige-points");
      const pMult = document.getElementById("prestige-mult");
      pPoints.textContent = formatNumber(gameState.prestigePoints);
      pMult.textContent = "x" + getPrestigeMultiplier().toFixed(2);

      const req = getPrestigeRequirement();
      const reqEl = document.getElementById("prestige-requirement");
      reqEl.textContent =
        "Need at least " +
        formatNumber(req) +
        " total 67s to prestige. (You have " +
        formatNumber(gameState.totalCurrency) +
        " total.)";

      const btnPrestige = document.getElementById("btn-prestige");
      const gain = calculatePrestigeGain();
      if (gain > 0) {
        btnPrestige.classList.remove("disabled");
        btnPrestige.textContent = "Ascend 67 (+" + gain + " Aura)";
      } else {
        btnPrestige.classList.add("disabled");
        btnPrestige.textContent = "Ascend 67";
      }
    }

    /**********************
     * CORE GAME LOGIC
     **********************/
    function getUpgradeCost(u, countOwned) {
      return Math.floor(u.baseCost * Math.pow(u.costScale, countOwned));
    }

    function buyUpgrade(upgradeId) {
      const u = upgradesConfig.find((x) => x.id === upgradeId);
      if (!u) return;

      const count = gameState.upgrades[upgradeId] || 0;
      const cost = getUpgradeCost(u, count);
      if (gameState.currency < cost) {
        addLog("<strong>Not enough 67:</strong> Need " + formatNumber(cost) + ".");
        return;
      }

      gameState.currency -= cost;
      gameState.upgrades[upgradeId] = count + 1;
      addLog(
        "<strong>Upgrade:</strong> Bought " +
          u.name +
          " for " +
          formatNumber(cost) +
          " 67."
      );
      renderUpgrades();
      renderStats();
      checkAchievements();
    }

    function handleClick(event) {
      const gain = getTotalClickPower();
      gameState.currency += gain;
      gameState.totalCurrency += gain;
      gameState.totalClicks += 1;

      const x = event.clientX || (event.touches && event.touches[0].clientX);
      const y = event.clientY || (event.touches && event.touches[0].clientY);
      if (x && y) spawnPop(x, y, "+" + formatNumber(gain));

      checkAchievements();
      renderStats();
    }

    function tick() {
      const now = Date.now();
      const diff = (now - gameState.lastTick) / 1000;
      gameState.lastTick = now;

      const cps = getTotalAutoPower();
      if (cps > 0 && diff > 0) {
        const gain = cps * diff;
        gameState.currency += gain;
        gameState.totalCurrency += gain;
      }

      renderStats();
      checkAchievements();
    }

    function checkAchievements() {
      let changed = false;
      achievementsConfig.forEach((a) => {
        if (gameState.achievementsUnlocked[a.id]) return;
        if (a.check(gameState)) {
          gameState.achievementsUnlocked[a.id] = true;
          changed = true;
          addLog("<strong>Achievement unlocked:</strong> " + a.name);
        }
      });
      if (changed) {
        renderAchievements();
      }
    }

    function doPrestige() {
      const gain = calculatePrestigeGain();
      if (gain <= 0) {
        addLog("<strong>Prestige blocked:</strong> Not enough total 67s yet.");
        return;
      }

      if (
        !confirm(
          "Ascend 67?\n\nYou will gain " +
            gain +
            " permanent 67 Aura.\nThis resets 67s, upgrades, and achievements, but not Aura.\n\nContinue?"
        )
      ) {
        return;
      }

      gameState.prestigePoints += gain;
      gameState.prestigeLevel += 1;
      addLog(
        "<strong>Prestige:</strong> Ascended with +" +
          gain +
          " 67 Aura. All gains are now stronger."
      );

      gameState.currency = 0;
      gameState.totalCurrency = 0;
      gameState.totalClicks = 0;
      gameState.perClickBase = 1;
      gameState.perSecondBase = 0;
      gameState.upgrades = {};
      gameState.achievementsUnlocked = {};
      gameState.lastTick = Date.now();

      renderUpgrades();
      renderAchievements();
      renderStats();
      saveGame();
    }

    /**********************
     * INIT
     **********************/
    function init() {
      loadGame();
      renderUpgrades();
      renderAchievements();
      renderStats();

      const mainClick = document.getElementById("main-click");

      mainClick.addEventListener("click", (e) => {
        e.preventDefault();
        handleClick(e);
      });

      mainClick.addEventListener("touchstart", (e) => {
        e.preventDefault();
        handleClick(e.touches[0]);
      });

      document.getElementById("btn-save").addEventListener("click", () => {
        saveGame();
      });

      document.getElementById("btn-hard-reset").addEventListener("click", () => {
        hardReset();
      });

      document.getElementById("btn-prestige").addEventListener("click", () => {
        if (document.getElementById("btn-prestige").classList.contains("disabled")) return;
        doPrestige();
      });

      setInterval(tick, 1000 / 20);
      setInterval(saveGame, 5000);
    }

    window.addEventListener("load", init);
  </script>
</body>
</html>
